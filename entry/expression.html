<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Expression | johnchen902's Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="johnchen902">
    <meta name="description" content="Find the shortest string that matches a given regular expression and contains a given substring.">
    <style>p{max-width:40em;}</style>
    <script>
      window.onload = function () {
        var ss = document.createElement("link");
        ss.rel = "stylesheet";
        ss.href = "/blog/prism.css";
        document.getElementsByTagName("head")[0].appendChild(ss);
      };
    </script>
    <noscript>
      <link rel="stylesheet" href="/blog/prism.css">
      <style> .scriptonly { display: none } </style>
    </noscript>

  </head>
  <body>
    <header>
      <h1>johnchen902's Blog</h1>
    </header>
    <nav>
      <a href="/blog/">Index</a>
    </nav>
    <article>
<header><h2>Expression</h2></header>
<section>
  <header><h3>Problem</h3></header>
  <p>
    Find the shortest string that matches a given regular
    expression and contains a given substring.
    The regular expression consists only of
    a to z, dot, alternation, concatenation, and kleene star.
    The length of both input are no more than 10000.
  </p>
</section>
<section>
  <header><h3>Solution</h3></header>
  <p>
    You can solve this problem only if you can check if
    the given string matches the regular expression.
    We can easily construct an equivalent NFA with
    only O(n) states and total transitions,
    but how to proceed from here?
    We can't construct a DFA because it takes
    exponential time.
  </p>
  <p>
    We can proceed by first recording the states reachable with
    the first character of the given string.
    Then, we can determine the states reachable
    with the first two characters in O(n).
    After m similar steps, we can determine the
    states reachable with the entire string.
    That means we can check if the NFA accepts
    a given string in O(nm).
  </p>
  <p>
    Alternatively, we can proceed with dynamic programming.
    The data we memorize is <em>whether the accept state
    can be reached from this state with this suffix
    of the given string</em>,
    and the transition is straight-forward.
    To prevent cyclic dependencies, we have to eliminate
    &epsilon;-cycles beforehand.
    The time complexity is also O(nm).
  </p>
  <p>
    Note: For an NFA with k transitions the complexity
    is O((n+k)m) for both algorithm.
  </p>
  <p>
    Back to the original problem. We can find the minimum
    characters needed from each state to the accept state
    easily with a backward bfs. Then we can change the latter
    algorithm to memorizing <em>the minimum characters
    needed to reach the accept state from this state
    with this suffix of the given string as prefix</em>.
    One more backward bfs
    and we can determine the length of the answer.
    Finally we can reconstruct the answer by backtracking.
  </p>
  <p>
    On Codeforces the memory limit is 256MiB. I have to use
    <code>int16_t</code> and can only afford n+1 states
    in the NFA.
  </p>
</section>
<section>
  <header><h3>Source Code</h3></header>
<pre><code class="languace-cpp"><span class="token macro property" >#<span class="token directive keyword" >include</span> <span class="token string" >&lt;cstdio></span></span>
<span class="token macro property" >#<span class="token directive keyword" >include</span> <span class="token string" >&lt;vector></span></span>
<span class="token macro property" >#<span class="token directive keyword" >include</span> <span class="token string" >&lt;stack></span></span>
<span class="token macro property" >#<span class="token directive keyword" >include</span> <span class="token string" >&lt;algorithm></span></span>
<span class="token macro property" >#<span class="token directive keyword" >include</span> <span class="token string" >&lt;utility></span></span>
<span class="token macro property" >#<span class="token directive keyword" >include</span> <span class="token string" >&lt;cassert></span></span>
<span class="token macro property" >#<span class="token directive keyword" >include</span> <span class="token string" >&lt;queue></span></span>
<span class="token macro property" >#<span class="token directive keyword" >include</span> <span class="token string" >&lt;cstring></span></span>
<span class="token macro property" >#<span class="token directive keyword" >include</span> <span class="token string" >&lt;functional></span></span>
<span class="token keyword" >using</span> <span class="token keyword" >namespace</span> std<span class="token punctuation" >;</span>

vector<span class="token operator" >&lt;</span>pair<span class="token operator" >&lt;</span><span class="token keyword" >char</span><span class="token punctuation" >,</span> <span class="token keyword" >int</span><span class="token operator" >>></span> adj<span class="token punctuation" >[</span><span class="token number" >10001</span><span class="token punctuation" >]</span><span class="token punctuation" >;</span>
<span class="token keyword" >int</span> nstates<span class="token punctuation" >;</span>
<span class="token keyword" >int</span> <span class="token function" >new_state</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >return</span> nstates<span class="token operator" >++</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >int</span> <span class="token function" >parse_a</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> s<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >int</span> <span class="token function" >parse_b</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> s<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >int</span> <span class="token function" >parse_c</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> s<span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token keyword" >int</span> <span class="token function" >parse_a</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> s<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >int</span> t <span class="token operator" >=</span> <span class="token function" >parse_b</span><span class="token punctuation" >(</span>s<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token keyword" >while</span><span class="token punctuation" >(</span><span class="token boolean" >true</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token keyword" >char</span> c <span class="token operator" >=</span> <span class="token function" >getchar</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token keyword" >if</span><span class="token punctuation" >(</span>c <span class="token operator" >==</span> <span class="token string" >'\n'</span> <span class="token operator" >||</span> c <span class="token operator" >==</span> <span class="token string" >')'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
            <span class="token function" >ungetc</span><span class="token punctuation" >(</span>c<span class="token punctuation" >,</span> <span class="token constant" >stdin</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            <span class="token keyword" >break</span><span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span>
        <span class="token function" >assert</span><span class="token punctuation" >(</span>c <span class="token operator" >==</span> <span class="token string" >'|'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token keyword" >int</span> s2 <span class="token operator" >=</span> <span class="token function" >new_state</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        adj<span class="token punctuation" >[</span>s<span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >emplace_back</span><span class="token punctuation" >(</span><span class="token string" >'\0'</span><span class="token punctuation" >,</span> s2<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token keyword" >int</span> t2 <span class="token operator" >=</span> <span class="token function" >parse_b</span><span class="token punctuation" >(</span>s2<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        adj<span class="token punctuation" >[</span>t2<span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >emplace_back</span><span class="token punctuation" >(</span><span class="token string" >'\0'</span><span class="token punctuation" >,</span> t<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>
    <span class="token keyword" >return</span> t<span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >int</span> <span class="token function" >parse_b</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> s<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >while</span><span class="token punctuation" >(</span><span class="token boolean" >true</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token keyword" >char</span> c <span class="token operator" >=</span> <span class="token function" >getchar</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token function" >ungetc</span><span class="token punctuation" >(</span>c<span class="token punctuation" >,</span> <span class="token constant" >stdin</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token keyword" >if</span><span class="token punctuation" >(</span>c <span class="token operator" >==</span> <span class="token string" >')'</span> <span class="token operator" >||</span> c <span class="token operator" >==</span> <span class="token string" >'|'</span> <span class="token operator" >||</span> c <span class="token operator" >==</span> <span class="token string" >'\n'</span><span class="token punctuation" >)</span>
            <span class="token keyword" >break</span><span class="token punctuation" >;</span>
        s <span class="token operator" >=</span> <span class="token function" >parse_c</span><span class="token punctuation" >(</span>s<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>
    <span class="token keyword" >return</span> s<span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >void</span> <span class="token function" >ignore_more_stars</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >int</span> c<span class="token punctuation" >;</span>
    <span class="token keyword" >while</span><span class="token punctuation" >(</span><span class="token punctuation" >(</span>c <span class="token operator" >=</span> <span class="token function" >getchar</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token operator" >==</span> <span class="token string" >'*'</span><span class="token punctuation" >)</span>
        <span class="token punctuation" >;</span>
    <span class="token function" >ungetc</span><span class="token punctuation" >(</span>c<span class="token punctuation" >,</span> <span class="token constant" >stdin</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >int</span> <span class="token function" >parse_c</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> s<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >int</span> c <span class="token operator" >=</span> <span class="token function" >getchar</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token keyword" >if</span><span class="token punctuation" >(</span>c <span class="token operator" >==</span> <span class="token string" >'.'</span> <span class="token operator" >||</span> <span class="token punctuation" >(</span>c <span class="token operator" >>=</span> <span class="token string" >'a'</span> <span class="token operator" >&amp;&amp;</span> c <span class="token operator" >&lt;=</span> <span class="token string" >'z'</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token keyword" >char</span> d <span class="token operator" >=</span> <span class="token function" >getchar</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token keyword" >if</span><span class="token punctuation" >(</span>d <span class="token operator" >==</span> <span class="token string" >'*'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
            <span class="token keyword" >int</span> t <span class="token operator" >=</span> <span class="token function" >new_state</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            adj<span class="token punctuation" >[</span>s<span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >emplace_back</span><span class="token punctuation" >(</span><span class="token string" >'\0'</span><span class="token punctuation" >,</span> t<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            adj<span class="token punctuation" >[</span>t<span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >emplace_back</span><span class="token punctuation" >(</span>c<span class="token punctuation" >,</span> t<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            <span class="token function" >ignore_more_stars</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            <span class="token keyword" >return</span> t<span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span> <span class="token keyword" >else</span> <span class="token punctuation" >{</span>
            <span class="token function" >ungetc</span><span class="token punctuation" >(</span>d<span class="token punctuation" >,</span> <span class="token constant" >stdin</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            <span class="token keyword" >int</span> t <span class="token operator" >=</span> <span class="token function" >new_state</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            adj<span class="token punctuation" >[</span>s<span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >emplace_back</span><span class="token punctuation" >(</span>c<span class="token punctuation" >,</span> t<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            <span class="token keyword" >return</span> t<span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span>
    <span class="token punctuation" >}</span> <span class="token keyword" >else</span> <span class="token keyword" >if</span><span class="token punctuation" >(</span>c <span class="token operator" >==</span> <span class="token string" >'*'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token function" >ignore_more_stars</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token keyword" >return</span> s<span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span> <span class="token keyword" >else</span> <span class="token punctuation" >{</span>
        <span class="token function" >assert</span><span class="token punctuation" >(</span>c <span class="token operator" >==</span> <span class="token string" >'('</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token keyword" >int</span> s2 <span class="token operator" >=</span> <span class="token function" >new_state</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        adj<span class="token punctuation" >[</span>s<span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >emplace_back</span><span class="token punctuation" >(</span><span class="token string" >'\0'</span><span class="token punctuation" >,</span> s2<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token keyword" >int</span> t <span class="token operator" >=</span> <span class="token function" >parse_a</span><span class="token punctuation" >(</span>s2<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token keyword" >char</span> rparen <span class="token operator" >=</span> <span class="token function" >getchar</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token function" >assert</span><span class="token punctuation" >(</span>rparen <span class="token operator" >==</span> <span class="token string" >')'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token keyword" >char</span> d <span class="token operator" >=</span> <span class="token function" >getchar</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token keyword" >if</span><span class="token punctuation" >(</span>d <span class="token operator" >==</span> <span class="token string" >'*'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
            adj<span class="token punctuation" >[</span>t<span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >emplace_back</span><span class="token punctuation" >(</span><span class="token string" >'\0'</span><span class="token punctuation" >,</span> s2<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            <span class="token function" >ignore_more_stars</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            <span class="token keyword" >return</span> s2<span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span> <span class="token keyword" >else</span> <span class="token punctuation" >{</span>
            <span class="token function" >ungetc</span><span class="token punctuation" >(</span>d<span class="token punctuation" >,</span> <span class="token constant" >stdin</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            <span class="token keyword" >return</span> t<span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span>
    <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >int</span> id<span class="token punctuation" >[</span><span class="token number" >10001</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span> low<span class="token punctuation" >[</span><span class="token number" >10001</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span> nextid <span class="token operator" >=</span> <span class="token number" >1</span><span class="token punctuation" >;</span>
<span class="token keyword" >bool</span> onstack<span class="token punctuation" >[</span><span class="token number" >10001</span><span class="token punctuation" >]</span><span class="token punctuation" >;</span>
stack<span class="token operator" >&lt;</span><span class="token keyword" >int</span><span class="token operator" >></span> tjstack<span class="token punctuation" >;</span>
<span class="token keyword" >int</span> mapp<span class="token punctuation" >[</span><span class="token number" >10001</span><span class="token punctuation" >]</span><span class="token punctuation" >;</span>
<span class="token keyword" >void</span> <span class="token function" >torjan</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> i<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    onstack<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span> <span class="token operator" >=</span> <span class="token boolean" >true</span><span class="token punctuation" >;</span>
    tjstack<span class="token punctuation" >.</span><span class="token function" >push</span><span class="token punctuation" >(</span>i<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    low<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span> <span class="token operator" >=</span> id<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span> <span class="token operator" >=</span> nextid<span class="token operator" >++</span><span class="token punctuation" >;</span>
    <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >auto</span> p <span class="token operator" >:</span> adj<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token keyword" >if</span><span class="token punctuation" >(</span>p<span class="token punctuation" >.</span>first<span class="token punctuation" >)</span>
            <span class="token keyword" >continue</span><span class="token punctuation" >;</span>
        <span class="token keyword" >int</span> c <span class="token operator" >=</span> p<span class="token punctuation" >.</span>second<span class="token punctuation" >;</span>
        <span class="token keyword" >if</span><span class="token punctuation" >(</span><span class="token operator" >!</span>id<span class="token punctuation" >[</span>c<span class="token punctuation" >]</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
            <span class="token function" >torjan</span><span class="token punctuation" >(</span>c<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            low<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span> <span class="token operator" >=</span> <span class="token function" >min</span><span class="token punctuation" >(</span>low<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >,</span> low<span class="token punctuation" >[</span>c<span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span> <span class="token keyword" >else</span> <span class="token keyword" >if</span><span class="token punctuation" >(</span>onstack<span class="token punctuation" >[</span>c<span class="token punctuation" >]</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
            low<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span> <span class="token operator" >=</span> <span class="token function" >min</span><span class="token punctuation" >(</span>low<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >,</span> id<span class="token punctuation" >[</span>c<span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span>
    <span class="token punctuation" >}</span>
    <span class="token keyword" >if</span><span class="token punctuation" >(</span>low<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span> <span class="token operator" >==</span> id<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token keyword" >int</span> x<span class="token punctuation" >;</span>
        <span class="token keyword" >do</span> <span class="token punctuation" >{</span>
            x <span class="token operator" >=</span> tjstack<span class="token punctuation" >.</span><span class="token function" >top</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            tjstack<span class="token punctuation" >.</span><span class="token function" >pop</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            onstack<span class="token punctuation" >[</span>x<span class="token punctuation" >]</span> <span class="token operator" >=</span> <span class="token boolean" >false</span><span class="token punctuation" >;</span>
            mapp<span class="token punctuation" >[</span>x<span class="token punctuation" >]</span> <span class="token operator" >=</span> i<span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span> <span class="token keyword" >while</span><span class="token punctuation" >(</span>x <span class="token operator" >!=</span> i<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span>
<span class="token keyword" >void</span> <span class="token function" >eliminate</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> i <span class="token operator" >=</span> <span class="token number" >0</span><span class="token punctuation" >;</span> i <span class="token operator" >&lt;</span> nstates<span class="token punctuation" >;</span> i<span class="token operator" >++</span><span class="token punctuation" >)</span>
        <span class="token keyword" >if</span><span class="token punctuation" >(</span>id<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span> <span class="token operator" >==</span> <span class="token number" >0</span><span class="token punctuation" >)</span>
            <span class="token function" >torjan</span><span class="token punctuation" >(</span>i<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> i <span class="token operator" >=</span> <span class="token number" >0</span><span class="token punctuation" >;</span> i <span class="token operator" >&lt;</span> nstates<span class="token punctuation" >;</span> i<span class="token operator" >++</span><span class="token punctuation" >)</span>
        <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >auto</span> <span class="token operator" >&amp;</span>p <span class="token operator" >:</span> adj<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >)</span>
            p<span class="token punctuation" >.</span>second <span class="token operator" >=</span> mapp<span class="token punctuation" >[</span>p<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span><span class="token punctuation" >;</span>
    <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> i <span class="token operator" >=</span> <span class="token number" >0</span><span class="token punctuation" >;</span> i <span class="token operator" >&lt;</span> nstates<span class="token punctuation" >;</span> i<span class="token operator" >++</span><span class="token punctuation" >)</span>
        <span class="token keyword" >if</span><span class="token punctuation" >(</span>i <span class="token operator" >!=</span> mapp<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
            adj<span class="token punctuation" >[</span>mapp<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >insert</span><span class="token punctuation" >(</span>adj<span class="token punctuation" >[</span>mapp<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >end</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
                    adj<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >begin</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span> adj<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >end</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            adj<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >clear</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span>
    <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> i <span class="token operator" >=</span> <span class="token number" >0</span><span class="token punctuation" >;</span> i <span class="token operator" >&lt;</span> nstates<span class="token punctuation" >;</span> i<span class="token operator" >++</span><span class="token punctuation" >)</span>
        adj<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >erase</span><span class="token punctuation" >(</span><span class="token function" >remove</span><span class="token punctuation" >(</span>adj<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >begin</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span> adj<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >end</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
                <span class="token function" >make_pair</span><span class="token punctuation" >(</span><span class="token string" >'\0'</span><span class="token punctuation" >,</span> i<span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span> adj<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >end</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

vector<span class="token operator" >&lt;</span>pair<span class="token operator" >&lt;</span><span class="token keyword" >bool</span><span class="token punctuation" >,</span> <span class="token keyword" >int</span><span class="token operator" >>></span> rev<span class="token punctuation" >[</span><span class="token number" >10001</span><span class="token punctuation" >]</span><span class="token punctuation" >;</span>
<span class="token keyword" >template</span><span class="token operator" >&lt;</span><span class="token keyword" >typename</span> T<span class="token operator" >></span>
<span class="token keyword" >void</span> <span class="token function" >backward_bfs</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> t<span class="token punctuation" >,</span> T <span class="token operator" >*</span>out<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> i <span class="token operator" >=</span> <span class="token number" >0</span><span class="token punctuation" >;</span> i <span class="token operator" >&lt;</span> nstates<span class="token punctuation" >;</span> i<span class="token operator" >++</span><span class="token punctuation" >)</span>
        <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >auto</span> p <span class="token operator" >:</span> adj<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >)</span>
            rev<span class="token punctuation" >[</span>p<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span><span class="token punctuation" >.</span><span class="token function" >emplace_back</span><span class="token punctuation" >(</span>p<span class="token punctuation" >.</span>first<span class="token punctuation" >,</span> i<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token function" >fill_n</span><span class="token punctuation" >(</span>out<span class="token punctuation" >,</span> nstates<span class="token punctuation" >,</span> <span class="token number" >32000</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token keyword" >using</span> P <span class="token operator" >=</span> pair<span class="token operator" >&lt;</span><span class="token keyword" >int</span><span class="token punctuation" >,</span> <span class="token keyword" >int</span><span class="token operator" >></span><span class="token punctuation" >;</span>
    priority_queue<span class="token operator" >&lt;</span>P<span class="token punctuation" >,</span> vector<span class="token operator" >&lt;</span>P<span class="token operator" >></span><span class="token punctuation" >,</span> greater<span class="token operator" >&lt;</span>P<span class="token operator" >>></span> pq<span class="token punctuation" >;</span>
    out<span class="token punctuation" >[</span>t<span class="token punctuation" >]</span> <span class="token operator" >=</span> <span class="token number" >0</span><span class="token punctuation" >;</span>
    pq<span class="token punctuation" >.</span><span class="token function" >push</span><span class="token punctuation" >(</span><span class="token function" >make_pair</span><span class="token punctuation" >(</span><span class="token number" >0</span><span class="token punctuation" >,</span> t<span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token keyword" >while</span><span class="token punctuation" >(</span><span class="token operator" >!</span>pq<span class="token punctuation" >.</span><span class="token function" >empty</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        P p <span class="token operator" >=</span> pq<span class="token punctuation" >.</span><span class="token function" >top</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        pq<span class="token punctuation" >.</span><span class="token function" >pop</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token keyword" >if</span><span class="token punctuation" >(</span>p<span class="token punctuation" >.</span>first <span class="token operator" >!=</span> out<span class="token punctuation" >[</span>p<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span><span class="token punctuation" >)</span>
            <span class="token keyword" >continue</span><span class="token punctuation" >;</span>
        <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >auto</span> q <span class="token operator" >:</span> rev<span class="token punctuation" >[</span>p<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span><span class="token punctuation" >)</span>
            <span class="token keyword" >if</span><span class="token punctuation" >(</span>out<span class="token punctuation" >[</span>q<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span> <span class="token operator" >></span> p<span class="token punctuation" >.</span>first <span class="token operator" >+</span> <span class="token punctuation" >(</span>q<span class="token punctuation" >.</span>first <span class="token operator" >?</span> <span class="token number" >1</span> <span class="token operator" >:</span> <span class="token number" >0</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
                out<span class="token punctuation" >[</span>q<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span> <span class="token operator" >=</span> p<span class="token punctuation" >.</span>first <span class="token operator" >+</span> <span class="token punctuation" >(</span>q<span class="token punctuation" >.</span>first <span class="token operator" >?</span> <span class="token number" >1</span> <span class="token operator" >:</span> <span class="token number" >0</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
                pq<span class="token punctuation" >.</span><span class="token function" >push</span><span class="token punctuation" >(</span><span class="token function" >make_pair</span><span class="token punctuation" >(</span>out<span class="token punctuation" >[</span>q<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span><span class="token punctuation" >,</span> q<span class="token punctuation" >.</span>second<span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            <span class="token punctuation" >}</span>
    <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >char</span> str<span class="token punctuation" >[</span><span class="token number" >10001</span><span class="token punctuation" >]</span><span class="token punctuation" >;</span>
int16_t dp<span class="token punctuation" >[</span><span class="token number" >10001</span><span class="token punctuation" >]</span><span class="token punctuation" >[</span><span class="token number" >10001</span><span class="token punctuation" >]</span><span class="token punctuation" >;</span>

<span class="token keyword" >int</span> <span class="token function" >dfs</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> st<span class="token punctuation" >,</span> <span class="token keyword" >int</span> si<span class="token punctuation" >,</span> <span class="token keyword" >int</span> n<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >if</span><span class="token punctuation" >(</span>si <span class="token operator" >==</span> n <span class="token operator" >||</span> dp<span class="token punctuation" >[</span>si<span class="token punctuation" >]</span><span class="token punctuation" >[</span>st<span class="token punctuation" >]</span><span class="token punctuation" >)</span>
        <span class="token keyword" >return</span> dp<span class="token punctuation" >[</span>si<span class="token punctuation" >]</span><span class="token punctuation" >[</span>st<span class="token punctuation" >]</span><span class="token punctuation" >;</span>
    <span class="token keyword" >int</span> ans <span class="token operator" >=</span> <span class="token number" >32000</span><span class="token punctuation" >;</span>
    <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >auto</span> p <span class="token operator" >:</span> adj<span class="token punctuation" >[</span>st<span class="token punctuation" >]</span><span class="token punctuation" >)</span>
        <span class="token keyword" >if</span><span class="token punctuation" >(</span>p<span class="token punctuation" >.</span>first <span class="token operator" >==</span> <span class="token string" >'\0'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
            ans <span class="token operator" >=</span> <span class="token function" >min</span><span class="token punctuation" >(</span>ans<span class="token punctuation" >,</span> <span class="token function" >dfs</span><span class="token punctuation" >(</span>p<span class="token punctuation" >.</span>second<span class="token punctuation" >,</span> si<span class="token punctuation" >,</span> n<span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span> <span class="token keyword" >else</span> <span class="token keyword" >if</span><span class="token punctuation" >(</span>p<span class="token punctuation" >.</span>first <span class="token operator" >==</span> <span class="token string" >'.'</span> <span class="token operator" >||</span> p<span class="token punctuation" >.</span>first <span class="token operator" >==</span> str<span class="token punctuation" >[</span>si<span class="token punctuation" >]</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
            ans <span class="token operator" >=</span> <span class="token function" >min</span><span class="token punctuation" >(</span>ans<span class="token punctuation" >,</span> <span class="token function" >dfs</span><span class="token punctuation" >(</span>p<span class="token punctuation" >.</span>second<span class="token punctuation" >,</span> si <span class="token operator" >+</span> <span class="token number" >1</span><span class="token punctuation" >,</span> n<span class="token punctuation" >)</span> <span class="token operator" >+</span> <span class="token number" >1</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span>
    <span class="token keyword" >return</span> dp<span class="token punctuation" >[</span>si<span class="token punctuation" >]</span><span class="token punctuation" >[</span>st<span class="token punctuation" >]</span> <span class="token operator" >=</span> ans<span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >int</span> ans<span class="token punctuation" >[</span><span class="token number" >10001</span><span class="token punctuation" >]</span><span class="token punctuation" >;</span>
<span class="token keyword" >void</span> <span class="token function" >backward_bfs2</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token function" >copy_n</span><span class="token punctuation" >(</span>dp<span class="token punctuation" >[</span><span class="token number" >0</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span> nstates<span class="token punctuation" >,</span> ans<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token keyword" >using</span> P <span class="token operator" >=</span> pair<span class="token operator" >&lt;</span><span class="token keyword" >int</span><span class="token punctuation" >,</span> <span class="token keyword" >int</span><span class="token operator" >></span><span class="token punctuation" >;</span>
    priority_queue<span class="token operator" >&lt;</span>P<span class="token punctuation" >,</span> vector<span class="token operator" >&lt;</span>P<span class="token operator" >></span><span class="token punctuation" >,</span> greater<span class="token operator" >&lt;</span>P<span class="token operator" >>></span> pq<span class="token punctuation" >;</span>
    <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> i <span class="token operator" >=</span> <span class="token number" >0</span><span class="token punctuation" >;</span> i <span class="token operator" >&lt;</span> nstates<span class="token punctuation" >;</span> i<span class="token operator" >++</span><span class="token punctuation" >)</span>
        <span class="token keyword" >if</span><span class="token punctuation" >(</span>i <span class="token operator" >==</span> mapp<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >)</span>
            pq<span class="token punctuation" >.</span><span class="token function" >push</span><span class="token punctuation" >(</span><span class="token function" >make_pair</span><span class="token punctuation" >(</span>ans<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >,</span> i<span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token keyword" >while</span><span class="token punctuation" >(</span><span class="token operator" >!</span>pq<span class="token punctuation" >.</span><span class="token function" >empty</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        P p <span class="token operator" >=</span> pq<span class="token punctuation" >.</span><span class="token function" >top</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        pq<span class="token punctuation" >.</span><span class="token function" >pop</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token keyword" >if</span><span class="token punctuation" >(</span>p<span class="token punctuation" >.</span>first <span class="token operator" >!=</span> ans<span class="token punctuation" >[</span>p<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span><span class="token punctuation" >)</span>
            <span class="token keyword" >continue</span><span class="token punctuation" >;</span>
        <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >auto</span> q <span class="token operator" >:</span> rev<span class="token punctuation" >[</span>p<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span><span class="token punctuation" >)</span>
            <span class="token keyword" >if</span><span class="token punctuation" >(</span>ans<span class="token punctuation" >[</span>q<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span> <span class="token operator" >></span> p<span class="token punctuation" >.</span>first <span class="token operator" >+</span> <span class="token punctuation" >(</span>q<span class="token punctuation" >.</span>first <span class="token operator" >?</span> <span class="token number" >1</span> <span class="token operator" >:</span> <span class="token number" >0</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
                ans<span class="token punctuation" >[</span>q<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span> <span class="token operator" >=</span> p<span class="token punctuation" >.</span>first <span class="token operator" >+</span> <span class="token punctuation" >(</span>q<span class="token punctuation" >.</span>first <span class="token operator" >?</span> <span class="token number" >1</span> <span class="token operator" >:</span> <span class="token number" >0</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
                pq<span class="token punctuation" >.</span><span class="token function" >push</span><span class="token punctuation" >(</span><span class="token function" >make_pair</span><span class="token punctuation" >(</span>ans<span class="token punctuation" >[</span>q<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span><span class="token punctuation" >,</span> q<span class="token punctuation" >.</span>second<span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            <span class="token punctuation" >}</span>
    <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >void</span> <span class="token function" >myputchar</span><span class="token punctuation" >(</span><span class="token keyword" >char</span> c<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >if</span><span class="token punctuation" >(</span>c <span class="token operator" >==</span> <span class="token string" >'.'</span><span class="token punctuation" >)</span>
        <span class="token function" >putchar</span><span class="token punctuation" >(</span><span class="token string" >'a'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token keyword" >else</span> <span class="token keyword" >if</span><span class="token punctuation" >(</span>c <span class="token operator" >>=</span> <span class="token string" >'a'</span> <span class="token operator" >&amp;&amp;</span> c <span class="token operator" >&lt;=</span> <span class="token string" >'z'</span><span class="token punctuation" >)</span>
        <span class="token function" >putchar</span><span class="token punctuation" >(</span>c<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >void</span> <span class="token function" >answer</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> x<span class="token punctuation" >,</span> <span class="token keyword" >int</span> t<span class="token punctuation" >,</span> <span class="token keyword" >int</span> n<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >while</span><span class="token punctuation" >(</span>dp<span class="token punctuation" >[</span><span class="token number" >0</span><span class="token punctuation" >]</span><span class="token punctuation" >[</span>x<span class="token punctuation" >]</span> <span class="token operator" >></span> ans<span class="token punctuation" >[</span>x<span class="token punctuation" >]</span><span class="token punctuation" >)</span>
        <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >auto</span> p <span class="token operator" >:</span> adj<span class="token punctuation" >[</span>x<span class="token punctuation" >]</span><span class="token punctuation" >)</span>
            <span class="token keyword" >if</span><span class="token punctuation" >(</span>ans<span class="token punctuation" >[</span>p<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span> <span class="token operator" >+</span> <span class="token punctuation" >(</span>p<span class="token punctuation" >.</span>first <span class="token operator" >?</span> <span class="token number" >1</span> <span class="token operator" >:</span> <span class="token number" >0</span><span class="token punctuation" >)</span> <span class="token operator" >==</span> ans<span class="token punctuation" >[</span>x<span class="token punctuation" >]</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
                <span class="token function" >myputchar</span><span class="token punctuation" >(</span>p<span class="token punctuation" >.</span>first<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
                x <span class="token operator" >=</span> p<span class="token punctuation" >.</span>second<span class="token punctuation" >;</span>
                <span class="token keyword" >break</span><span class="token punctuation" >;</span>
            <span class="token punctuation" >}</span>
    <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> i <span class="token operator" >=</span> <span class="token number" >0</span><span class="token punctuation" >;</span> i <span class="token operator" >&lt;</span> n<span class="token punctuation" >;</span><span class="token punctuation" >)</span>
        <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >auto</span> p <span class="token operator" >:</span> adj<span class="token punctuation" >[</span>x<span class="token punctuation" >]</span><span class="token punctuation" >)</span>
            <span class="token keyword" >if</span><span class="token punctuation" >(</span>p<span class="token punctuation" >.</span>first <span class="token operator" >==</span> <span class="token string" >'\0'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
                <span class="token keyword" >if</span><span class="token punctuation" >(</span>dp<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >[</span>p<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span> <span class="token operator" >==</span> dp<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >[</span>x<span class="token punctuation" >]</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
                    x <span class="token operator" >=</span> p<span class="token punctuation" >.</span>second<span class="token punctuation" >;</span>
                    <span class="token keyword" >break</span><span class="token punctuation" >;</span>
                <span class="token punctuation" >}</span>
            <span class="token punctuation" >}</span> <span class="token keyword" >else</span> <span class="token keyword" >if</span><span class="token punctuation" >(</span>p<span class="token punctuation" >.</span>first <span class="token operator" >==</span> <span class="token string" >'.'</span> <span class="token operator" >||</span> p<span class="token punctuation" >.</span>first <span class="token operator" >==</span> str<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
                <span class="token keyword" >if</span><span class="token punctuation" >(</span>dp<span class="token punctuation" >[</span>i <span class="token operator" >+</span> <span class="token number" >1</span><span class="token punctuation" >]</span><span class="token punctuation" >[</span>p<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span> <span class="token operator" >==</span> dp<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >[</span>x<span class="token punctuation" >]</span> <span class="token operator" >-</span> <span class="token number" >1</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
                    <span class="token function" >myputchar</span><span class="token punctuation" >(</span>str<span class="token punctuation" >[</span>i<span class="token operator" >++</span><span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
                    x <span class="token operator" >=</span> p<span class="token punctuation" >.</span>second<span class="token punctuation" >;</span>
                    <span class="token keyword" >break</span><span class="token punctuation" >;</span>
                <span class="token punctuation" >}</span>
            <span class="token punctuation" >}</span>
    <span class="token keyword" >while</span><span class="token punctuation" >(</span>x <span class="token operator" >!=</span> t<span class="token punctuation" >)</span>
        <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >auto</span> p <span class="token operator" >:</span> adj<span class="token punctuation" >[</span>x<span class="token punctuation" >]</span><span class="token punctuation" >)</span>
            <span class="token keyword" >if</span><span class="token punctuation" >(</span>dp<span class="token punctuation" >[</span>n<span class="token punctuation" >]</span><span class="token punctuation" >[</span>p<span class="token punctuation" >.</span>second<span class="token punctuation" >]</span> <span class="token operator" >+</span> <span class="token punctuation" >(</span>p<span class="token punctuation" >.</span>first <span class="token operator" >?</span> <span class="token number" >1</span> <span class="token operator" >:</span> <span class="token number" >0</span><span class="token punctuation" >)</span> <span class="token operator" >==</span> dp<span class="token punctuation" >[</span>n<span class="token punctuation" >]</span><span class="token punctuation" >[</span>x<span class="token punctuation" >]</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
                <span class="token function" >myputchar</span><span class="token punctuation" >(</span>p<span class="token punctuation" >.</span>first<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
                x <span class="token operator" >=</span> p<span class="token punctuation" >.</span>second<span class="token punctuation" >;</span>
                <span class="token keyword" >break</span><span class="token punctuation" >;</span>
            <span class="token punctuation" >}</span>
    <span class="token function" >putchar</span><span class="token punctuation" >(</span><span class="token string" >'\n'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >int</span> <span class="token function" >main</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token comment" spellcheck="true">// parse input</span>
    <span class="token keyword" >int</span> s <span class="token operator" >=</span> <span class="token function" >new_state</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token keyword" >int</span> t <span class="token operator" >=</span> <span class="token function" >parse_a</span><span class="token punctuation" >(</span>s<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token function" >scanf</span><span class="token punctuation" >(</span><span class="token string" >"%s"</span><span class="token punctuation" >,</span> str<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token keyword" >int</span> n <span class="token operator" >=</span> <span class="token function" >strlen</span><span class="token punctuation" >(</span>str<span class="token punctuation" >)</span><span class="token punctuation" >;</span>

    <span class="token comment" spellcheck="true">// eliminate ε-cycles</span>
    <span class="token function" >eliminate</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    s <span class="token operator" >=</span> mapp<span class="token punctuation" >[</span>s<span class="token punctuation" >]</span><span class="token punctuation" >;</span>
    t <span class="token operator" >=</span> mapp<span class="token punctuation" >[</span>t<span class="token punctuation" >]</span><span class="token punctuation" >;</span>
    <span class="token comment" spellcheck="true">// backward bfs</span>
    <span class="token function" >backward_bfs</span><span class="token punctuation" >(</span>t<span class="token punctuation" >,</span> dp<span class="token punctuation" >[</span>n<span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token comment" spellcheck="true">// dp</span>
    <span class="token keyword" >for</span><span class="token punctuation" >(</span><span class="token keyword" >int</span> i <span class="token operator" >=</span> <span class="token number" >0</span><span class="token punctuation" >;</span> i <span class="token operator" >&lt;</span> nstates<span class="token punctuation" >;</span> i<span class="token operator" >++</span><span class="token punctuation" >)</span>
        <span class="token keyword" >if</span><span class="token punctuation" >(</span>i <span class="token operator" >==</span> mapp<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >)</span>
            <span class="token function" >dfs</span><span class="token punctuation" >(</span>i<span class="token punctuation" >,</span> <span class="token number" >0</span><span class="token punctuation" >,</span> n<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token comment" spellcheck="true">// backward bfs 2</span>
    <span class="token function" >backward_bfs2</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token comment" spellcheck="true">// finally</span>
    <span class="token keyword" >if</span><span class="token punctuation" >(</span>ans<span class="token punctuation" >[</span>s<span class="token punctuation" >]</span> <span class="token operator" >>=</span> <span class="token number" >31000</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token function" >puts</span><span class="token punctuation" >(</span><span class="token string" >"NO"</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token keyword" >return</span> <span class="token number" >0</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>
    <span class="token function" >answer</span><span class="token punctuation" >(</span>s<span class="token punctuation" >,</span> t<span class="token punctuation" >,</span> n<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
</section>
<footer>
  <p>
    Problem source:
    <a href="http://codeforces.com/gym/100531" rel="nofollow">
    2014-2015 ACM-ICPC, NEERC, Northern Subregional Contest</a>
    E - Expression
  </p>

  <p>
    Written on <time datetime="2016-09-09T01:00:00+0800">September 09 2016</time>.
  </p>
</footer>

    </article>
    <footer>
      <p>
        All codes here come with ABSOLUTELY NO WARRANTY.
        These codes are licensed under the GNU AGPLv3.
        See <a href="https://www.gnu.org/licenses/">
        https://www.gnu.org/licenses/</a> for detail.
      </p>
    </footer>
  </body>
</html>

